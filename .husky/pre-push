#!/bin/sh
# Pre-push hook: Warn about production migrations

echo "ğŸ” Checking for migrations that need to run in production..."

# Get the list of new migrations in this push
NEW_MIGRATIONS=$(git diff --name-only HEAD...origin/main | grep "^migrations/.*\.sql$" || true)

if [ -n "$NEW_MIGRATIONS" ]; then
    echo ""
    echo "âš ï¸  NEW MIGRATIONS DETECTED âš ï¸"
    echo ""
    echo "The following migrations will be pushed to production:"
    echo "$NEW_MIGRATIONS"
    echo ""
    echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
    echo "â”‚  REMINDER: Production Database Needs Manual Migration       â”‚"
    echo "â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤"
    echo "â”‚  Option 1: Supabase CLI                                     â”‚"
    echo "â”‚    npx supabase db push                                   â”‚"
    echo "â”‚                                                           â”‚"
    echo "â”‚  Option 2: Supabase Dashboard                               â”‚"
    echo "â”‚    SQL Editor â†’ New Query â†’ Paste migration SQL            â”‚"
    echo "â”‚                                                           â”‚"
    echo "â”‚  See: PRODUCTION_READINESS.md for full instructions       â”‚"
    echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
    echo ""
fi

exit 0
