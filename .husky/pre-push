#!/bin/sh
# Pre-push hook: Warn about production migrations

echo "üîç Checking for migrations that need to run in production..."

# Get the list of new migrations in this push
NEW_MIGRATIONS=$(git diff --name-only HEAD...origin/main | grep "^migrations/.*\.sql$" || true)

if [ -n "$NEW_MIGRATIONS" ]; then
    echo ""
    echo "‚ö†Ô∏è  NEW MIGRATIONS DETECTED ‚ö†Ô∏è"
    echo ""
    echo "The following migrations will be pushed to production:"
    echo "$NEW_MIGRATIONS"
    echo ""
    echo "REMEMBER: You must manually run these in production!"
    echo ""
    echo "Options:"
    echo "1. Supabase Dashboard ‚Üí SQL Editor (copy/paste SQL)"
    echo "2. supabase db push (if using CLI)"
    echo "3. Copy from migrations/001_*.sql files"
    echo ""
    echo "See: PRODUCTION_READINESS.md for details"
    echo ""
    
    # Ask for confirmation (only if interactive)
    if [ -t 1 ]; then
        printf "Continue with push? (y/N): "
        read -r response
        case "$response" in
            [yY][eE][sS]|[yY]) 
                echo "Proceeding with push..."
                ;;
            *)
                echo "Push cancelled. Run migrations in production first."
                exit 1
                ;;
        esac
    fi
fi

exit 0
